pbjsChunk([204],{531:function(e,d,i){e.exports=i(532)},532:function(e,d,i){"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.validateMultibid=g,d.adjustBidderRequestsHook=y,d.addBidResponseHook=x,d.sortByMultibid=h,d.targetBidPoolHook=B,i.d(d,"resetMultiConfig",(function(){return j})),i.d(d,"resetMultibidUnits",(function(){return O}));var r=i(3),t=i(8),o=i(0),n=i(10),a=i.n(n),c=i(5),b=i.n(c),u=i(19),l=i(23);function s(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,d){if(!e)return;if("string"==typeof e)return f(e,d);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return f(e,d)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,d){(null==d||d>e.length)&&(d=e.length);for(var i=0,r=new Array(d);i<d;i++)r[i]=e[i];return r}var p=!1,m={},C={};function g(e){var d=!0,i=e.filter((function(e){return!!(e.bidder&&"string"==typeof e.bidder||e.bidders&&Array.isArray(e.bidders))||(Object(o.logWarn)("Filtering multibid entry. Missing required bidder or bidders property."),d=!1,!1)})).map((function(e){return("number"!=typeof e.maxBids||e.maxBids<1||e.maxBids>9)&&(e.maxBids="number"!=typeof e.maxBids||e.maxBids<1?1:9,d=!1),e}));return d||r.b.setConfig({multibid:i}),d}function y(e,d){d.map((function(e){return m[e.bidderCode]&&(e.bidLimit=m[e.bidderCode].maxbids),e})),e.call(this,d)}function x(e,d,i){var t=Object(o.deepAccess)(i,"floorData.floorValue");if(r.b.getConfig("multibid")||j(),p&&m[i.bidderCode]&&"adpod"===Object(o.deepAccess)(i,"video.context"))e.call(this,d,i);else if(p&&m[i.bidderCode])if(m[i.bidderCode].prefix&&(i.multibidPrefix=m[i.bidderCode].prefix),i.originalBidder=i.bidderCode,Object(o.deepAccess)(C,[d,i.bidderCode]))if(C[d][i.bidderCode].maxReached||t&&!(t<=i.cpm))Object(o.logWarn)("Filtering multibid received from bidder ".concat(i.bidderCode,": ")+(C[d][i.bidderCode].maxReached?"Maximum bid limit reached for ad unit code ".concat(d):"Bid cpm under floors value."));else{i.originalRequestId=i.requestId,i.requestId=Object(o.getUniqueIdentifierStr)(),C[d][i.bidderCode].ads.push(i);var n=C[d][i.bidderCode].ads.length;m[i.bidderCode].prefix&&(i.targetingBidder=m[i.bidderCode].prefix+n),n===m[i.bidderCode].maxbids&&(C[d][i.bidderCode].maxReached=!0),e.call(this,d,i)}else Object(o.deepAccess)(i,"floorData.floorValue")&&Object(o.deepSetValue)(C,[d,i.bidderCode],{floor:Object(o.deepAccess)(i,"floorData.floorValue")}),Object(o.deepSetValue)(C,[d,i.bidderCode],{ads:[i]}),C[d][i.bidderCode].ads.length===m[i.bidderCode].maxbids&&(C[d][i.bidderCode].maxReached=!0),e.call(this,d,i);else e.call(this,d,i)}function h(e,d){return e.bidder!==e.bidderCode&&d.bidder===d.bidderCode?1:e.bidder===e.bidderCode&&d.bidder!==d.bidderCode?-1:0}function B(e,d,i){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(r.b.getConfig("multibid")||j(),p){var n=r.b.getConfig("sendBidsControl.dealPrioritization"),a=[],c=Object(o.groupBy)(d,"adUnitCode"),b=[].concat.apply([],Object.keys(c).reduce((function(e,d){var r=[],b=Object(o.groupBy)(c[d],"originalBidder"),u=[].concat.apply([],Object.keys(b).map((function(e){return b[e].sort((function(e,d){return e.originalBidder&&e.originalBidder!==e.bidderCode&&(e.bidderCode=e.originalBidder),e.originalBidder&&d.originalBidder!==d.bidderCode&&(d.bidderCode=d.originalBidder),e.cpm>d.cpm?-1:e.cpm<d.cpm?1:0})).map((function(e,d){return Object(o.deepAccess)(m,"".concat(e.bidderCode,".prefix"))&&0!==d&&d<m[e.bidderCode].maxbids&&(e.bidderCode=m[e.bidderCode].prefix+(d+1)),e}))}))),f=Object(o.groupBy)(u,"bidderCode");return Object.keys(f).forEach((function(e){return r.push(f[e].reduce(i))})),t>0?((r=n?r.sort(Object(l.c)(!0)):r.sort((function(e,d){return d.cpm-e.cpm}))).sort(h),a.push.apply(a,s(r.slice(0,t)))):a.push.apply(a,s(r)),[].concat.apply([],a)}),[]));e.call(this,b,i,t,!0)}else e.call(this,d,i,t)}r.b.getConfig("multibid",(function(e){Array.isArray(e.multibid)&&e.multibid.length&&g(e.multibid)&&(j(),p=!0,e.multibid.forEach((function(e){e.bidder?m[e.bidder]={maxbids:e.maxBids,prefix:e.targetBiddercodePrefix}:e.bidders.forEach((function(d){m[d]={maxbids:e.maxBids,prefix:e.targetBiddercodePrefix}}))})))}));var j=function(){p=!1,m={}},O=function(){return C={}};a.a.on(b.a.EVENTS.AUCTION_INIT,O),Object(t.d)(u.e,y),Object(t.a)("addBidResponse").before(x,3),Object(t.d)(l.b,B),window.pbjs.installedModules.push("multibid")}},[531]);