pbjsChunk([98],{815:function(e,t,n){e.exports=n(816)},816:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"MODULE_NAME",(function(){return c})),t.init=s,t.startMeasurement=m,t.stopMeasurement=b,t.receiveMessage=v;var i=n(0),o=n(14),r=n(11),a=n.n(r),c="viewability";function s(){Object(o.a)().viewability={startMeasurement:m,stopMeasurement:b},window.addEventListener("message",v,!1)}var u={};function l(e,t,n,o){return t?n&&("img"===n.method&&Object(i.isStr)(n.value)||"js"===n.method&&Object(i.isStr)(n.value)||"callback"===n.method&&Object(i.isFn)(n.value))?o&&o.inViewThreshold&&o.timeInView?!(!e||u[e])||(Object(i.logWarn)("".concat(c,": must provide an unregistered vid"),e),!1):(Object(i.logWarn)("".concat(c,": missing criteria"),o),!1):(Object(i.logWarn)("".concat(c,": invalid tracker"),n),!1):(Object(i.logWarn)("".concat(c,": no html element provided")),!1)}function d(e,t,n,o){!function(e,t,n){e.unobserve(n),u[t].done=!0}(e,t,n),function(e,t){switch(t.method){case"img":Object(i.triggerPixel)(t.value,(function(){Object(i.logInfo)("".concat(c,": viewability pixel fired"),t.value)}));break;case"js":Object(i.insertHtmlIntoIframe)('<script src="'.concat(t.value,'"><\/script>'));break;case"callback":t.value(e)}}(n,o)}function m(e,t,n,o){if(l(e,t,n,o)){var r,a={root:null,rootMargin:"0px",threshold:o.inViewThreshold},s=function(i){i[0].isIntersecting?u[e].timeoutId=window.setTimeout((function(){d(r,e,t,n)}),o.timeInView):u[e].timeoutId&&window.clearTimeout(u[e].timeoutId)};r=new IntersectionObserver(s,a),u[e]={observer:r,element:t,timeoutId:null,done:!1},r.observe(t),Object(i.logInfo)("".concat(c,": startMeasurement called with:"),arguments)}}function b(e){e&&u[e]?(u[e].observer.unobserve(u[e].element),u[e].timeoutId&&window.clearTimeout(u[e].timeoutId),u[e].done||delete u[e]):Object(i.logWarn)("".concat(c,": must provide a registered vid"),e)}function v(e){var t=e.message?"message":"data",n={};try{n=JSON.parse(e[t])}catch(e){return}if(n&&"Prebid Viewability"===n.message)switch(n.action){case"startMeasurement":var i=n.elementId&&document.getElementById(n.elementId);i||(i=a()(document.getElementsByTagName("IFRAME"),(function(t){return(t.contentWindow||t.contentDocument.defaultView)==e.source}))),m(n.vid,i,n.tracker,n.criteria);break;case"stopMeasurement":b(n.vid)}}s(),window.pbjs.installedModules.push("viewability")}},[815]);