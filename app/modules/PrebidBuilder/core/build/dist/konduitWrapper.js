pbjsChunk([230],{463:function(e,r,t){e.exports=t(464)},464:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),t.d(r,"errorMessages",(function(){return v})),r.processBids=j;var n=t(0),o=t(31),i=t(23),a=t(3),c=t(4),d=t(29),s=t(19),u=t(16);function l(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"==typeof e)return b(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return b(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var p="1.0.0",f="konduit.konduitId",g="enableSendAllBids",v={NO_KONDUIT_ID:"A konduitId param is required to be in configs",NO_BIDS:"No bids received in the auction",NO_BID:"A bid was not found",CACHE_FAILURE:"A bid was not cached"};function h(e){return(e.protocol||"http")+"://"+(e.host||e.hostname+(e.port?":".concat(e.port):""))+(e.pathname||"")+(e.search?"?".concat((r=e.search||"",Object.keys(r).map((function(e){return Array.isArray(r[e])?r[e].map((function(r){return"".concat(e,"[]=").concat(r)})).join("&"):"".concat(e,"=").concat(r[e])})).join("&"))):"")+(e.hash?"#".concat(e.hash):"");var r}function m(e){return(e=[].slice.call(e)).unshift("".concat("Konduit",": ")),e}function y(){n.logInfo.apply(void 0,l(m(arguments)))}function k(){n.logError.apply(void 0,l(m(arguments)))}function C(e){var r=e.host,t=void 0===r?"p.konduit.me":r,n=e.protocol,o=void 0===n?"https":n,i=e.method,a=void 0===i?"GET":i,d=e.path,s=e.payload,u=e.callbacks,l=e.timeout,b={protocol:o,hostname:t,pathname:d};"GET"===a&&(b.search=s);var p=h(b);Object(c.b)(l)(p,u,"POST"===a?JSON.stringify(s):null,{contentType:"application/json",method:a,withCredentials:!0})}function I(e){return{auctionId:e.auctionId,vastUrl:e.vastUrl,bidderCode:e.bidderCode,creativeId:e.creativeId,adUnitCode:e.adUnitCode,cpm:e.cpm,currency:e.currency}}function _(e,r,t){e.kCpm=e.cpm,e.adserverTargeting||(e.adserverTargeting={});var n=Object(s.h)(t)(e);a.b.getConfig(g)&&(e.adserverTargeting["k_cpm_".concat(e.bidderCode)]=n),r.bidderCode===e.bidderCode&&r.creativeId===e.creativeId&&(e.adserverTargeting.k_cpm=n)}function O(e,r,t,o){if(Object(n.isNumber)(e)){r.kCpm=e;var i=Object(d.a)(e,a.b.getConfig("customPriceBucket"),a.b.getConfig("currency.granularityMultiplier")),c=i.custom||i[o]||i.med;a.b.getConfig(g)&&(r.adserverTargeting["k_cpm_".concat(r.bidderCode)]=c),t.bidderCode===r.bidderCode&&t.creativeId===r.creativeId&&(r.adserverTargeting.k_cpm=c)}}function T(e,r,t){Object(n.isStr)(e)&&(r.konduitCacheKey=e,a.b.getConfig(g)&&(r.adserverTargeting["k_cache_key_".concat(r.bidderCode)]=e),t.bidderCode===r.bidderCode&&t.creativeId===r.creativeId&&(r.adserverTargeting.k_cache_key=e,r.adserverTargeting.konduit_cache_key=e))}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=a.b.getConfig(f);if(e=e||{},!r)return k(v.NO_KONDUIT_ID),e.callback&&e.callback(new Error(v.NO_KONDUIT_ID),[]),null;var t=e.bids||u.a.getBidsReceived(),o=e.bid||i.d.getWinningBids(e.adUnitCode,t)[0],c=[];if(a.b.getConfig(g)?c.push.apply(c,l(t)):o&&c.push(o),!c.length)return k(v.NO_BIDS),e.callback&&e.callback(new Error(v.NO_BIDS),[]),null;var d=a.b.getConfig("priceGranularity"),s=[];c.forEach((function(e){_(e,o,d),s.push(I(e))})),C({method:"POST",path:"/api/bidsProcessor",timeout:e.timeout||1e3,payload:{clientId:r,konduitPrebidModuleVersion:p,enableSendAllBids:a.b.getConfig(g),bids:s,bidResponsesCount:u.a.getBidsReceived().length},callbacks:{success:function(t){var i=null;y("Bids processed successfully ",t);try{var a=JSON.parse(t),s=a.kCpmData,u=a.cacheData;if(Object(n.isEmpty)(u))throw new Error(v.CACHE_FAILURE);o.adserverTargeting.konduit_id=r,o.adserverTargeting.k_id=r,c.forEach((function(e){var r="".concat(e.bidderCode,":").concat(e.creativeId);O(s[r],e,o,d),T(u[r],e,o)}))}catch(e){i=e,k("Error parsing JSON response for bidsProcessor data: ",e)}e.callback&&e.callback(i,c)},error:function(r){k("Bids were not processed successfully ",r),e.callback&&e.callback(Object(n.isStr)(r)?new Error(r):r,c)}}})}Object(o.a)("konduit",{processBids:j}),window.pbjs.installedModules.push("konduitWrapper")}},[463]);