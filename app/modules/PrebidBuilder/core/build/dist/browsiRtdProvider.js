pbjsChunk([332],{221:function(t,e,r){t.exports=r(222)},222:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addBrowsiTag=w,e.collectData=h,e.setData=D,e.getCurrentData=P,e.isIdMatchingAdUnit=S,e.getMacroId=N,r.d(e,"browsiSubmodule",(function(){return I}));var n=r(0),o=r(8),i=r(4),c=r(21),a=r(7),u=r(11),s=r.n(u),b=r(14),l=r(12),f=r.n(l);function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function p(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach((function(e){g(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function g(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var O=Object(a.b)(),j={},m=null,y=null,v={};function w(t){var e=Object(c.a)(t.u,"browsi");return e.async=!0,e.setAttribute("data-sitekey",j.siteKey),e.setAttribute("data-pubkey",j.pubKey),e.setAttribute("prebidbpt","true"),e.setAttribute("id","browsi-tag"),e.setAttribute("src",t.u),e.prebidData=Object(n.deepClone)(t),j.keyName&&(e.prebidData.kn=j.keyName),e}function h(){var t=window.top,e=t.document,r=null;try{r=O.getDataFromLocalStorage("__brtd")}catch(t){Object(n.logError)("unable to parse __brtd")}var o,c,a=p(p(p(p({},{sk:j.siteKey,sw:t.screen&&t.screen.width||-1,sh:t.screen&&t.screen.height||-1,url:"".concat(e.location.protocol,"//").concat(e.location.host).concat(e.location.pathname)}),r?{us:r}:{us:"{}"}),document.referrer?{r:document.referrer}:{}),document.title?{at:document.title}:{});o="//".concat(j.url,"/prebid?").concat((c=a,Object.keys(c).map((function(t){return t+"="+encodeURIComponent(c[t])})).join("&"))),Object(i.b)()(o,{success:function(t,e){if(200===e.status)try{var r=JSON.parse(t);r&&r.p&&r.kn?D({p:r.p,kn:r.kn,pmd:r.pmd}):D({}),w(r)}catch(t){Object(n.logError)("unable to parse data"),D({})}else 204===e.status&&D({})},error:function(){D({}),Object(n.logError)("unable to get prediction data")}})}function D(t){m=t,Object(n.isFn)(y)&&(y(m),y=null)}function k(t){try{var e=m&&m.p||{};return t.reduce((function(t,r){v[r]=v[r]||0;var o=v[r];if(!r)return t;var i=function(t){var e=Object(n.isGptPubadsDefined)()&&window.googletag.pubads().getSlots();if(!e||!e.length)return null;return s()(e,(function(e){return e.getSlotElementId()===t||e.getAdUnitPath()===t}))||null}(r),c=i?N(m.pmd,i):r,a=e[c];if(t[r]=E(-1),!a)return t;if(a.ps){if(!S(i,a.w))return t;t[r]=E(P(a.ps,o))}return t}),{})}catch(t){return{}}}function P(t,e){if(!t||!Object(n.isNumber)(e))return-1;if(Object(n.isNumber)(t[e]))return t[e];if(Object.keys(t).length>1)for(;e>0;)if(e--,Object(n.isNumber)(t[e]))return t[e];return-1}function E(t){var e=t<0?"NA":(Math.floor(10*t)/10).toFixed(2),r={};return r[A()]=e.toString(),r}function A(){return(j.keyName||m&&m.kn||"browsiViewability").toString()}function S(t,e){if(!e||!e.length||!t)return!0;var r=t.getAdUnitPath();return-1!==e.indexOf(r)}function N(t,e){if(t)try{return function(t,e,r,n){var o=t.p.replace(/['"]+/g,"").replace(/<DIV_ID>/g,e);r&&(o=o.replace(/<AD_UNIT>/g,r));n&&(o=o.replace(/<KEY_(\w+)>/g,n));t.s&&(o=o.substring(t.s.s,t.s.e));return o}(t,e.getSlotElementId(),e.getAdUnitPath(),(function(t,r){return r&&e.getTargeting(r).join("_")||"NA"}))}catch(e){Object(n.logError)("failed to evaluate: ".concat(t))}return e.getSlotElementId()}var I={name:"browsi",getTargetingData:function(t){var e=k(t);return t.forEach((function(t){Object(n.isNumber)(v[t])&&(v[t]=v[t]+1)})),e},init:function(t){(j=t.params)&&j.siteKey&&j.pubKey&&j.url?h():Object(n.logError)("missing params for Browsi provider");return!0},getBidRequestData:function(t,e){var r=t.adUnitCodes,o=t.adUnits||Object(b.a)().adUnits||[];r?o=o.filter((function(t){return f()(r,t.code)})):r=o.map((function(t){return t.code})),function(t){m?(y=null,t(m)):y=t}((function(){var t=k(r);t&&o.forEach((function(e){var r=e.code;t[r]&&Object(n.deepSetValue)(e,"ortb2Imp.ext.data.browsi",g({},A(),t[r][A()]))})),e()}))}};Object(o.e)("realTimeData",I),window.pbjs.installedModules.push("browsiRtdProvider")}},[221]);